#!/bin/bash

# Step 1: Get the raw values, filtering only relevant ones
raw=$(node scrolllink.js 'https://www.flipkart.com/travel/flights/search?trips=BLR-BOM-25042025&travellers=1-0-0&class=e&tripType=ONE_WAY&isIntl=false&source=TravelFlightFareCard' |
  grep -oP 'â‚¹[0-9,]+|[0-9]{2}:[0-9]{2}|[A-Z]{2}-\d{3,4}|(?:Air India|Akasa Air|IndiGo)|\d+h \d+m' |
  grep -v 'Non stop')

# Step 2: Save only clean matches into an array
mapfile -t lines <<< "$raw"

# Step 3: Print header
printf "%-10s %-10s %-8s %-9s %-8s %-9s %-9s %-5s\n" "Airline" "Flight" "DepTime" "Duration" "Arrival" "Price" "Discount" "Tax"

# Step 4: Read data in chunks of 8
i=0
while [ $i -lt ${#lines[@]} ]; do
    airline="${lines[$i]}"
    flight="${lines[$((i+1))]}"
    dept="${lines[$((i+2))]}"
    duration="${lines[$((i+3))]}"
    arrival="${lines[$((i+4))]}"
    price="${lines[$((i+5))]}"
    discount="${lines[$((i+6))]}"
    tax="${lines[$((i+7))]}"
    
    # Sanity check: All 8 fields must be non-empty
    if [[ -n "$airline" && -n "$flight" && -n "$dept" && -n "$duration" && -n "$arrival" && -n "$price" && -n "$discount" && -n "$tax" ]]; then
        printf "%-10s %-10s %-8s %-9s %-8s %-9s %-9s %-5s\n" "$airline" "$flight" "$dept" "$duration" "$arrival" "$price" "$discount" "$tax"
    fi

    i=$((i + 8))
done

